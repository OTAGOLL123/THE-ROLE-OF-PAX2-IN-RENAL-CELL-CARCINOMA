#!/bin/bash

# Align sequencing reads to a reference genome using HISAT2

# Path to the indexed reference genome (prefix generated by hisat2-build)
index_prefix=./reference_index

# Input and output directories
input_dir=./fastq_cleaned
output_dir=./hisat2_output

# Create output directory if it doesn't exist
mkdir -p $output_dir

# Loop through all cleaned FASTQ files in the input directory
for fq in ${input_dir}/*.clean.fastq.gz; do
  sample_name=$(basename "$fq" .clean.fastq.gz)

  # Run HISAT2 alignment
  hisat2 \
    --new-summary \                           # Enable concise alignment summary
    -p 16 \                                   # Number of threads
    -x $index_prefix \                        # Indexed reference genome prefix
    -U $fq \                                  # Input: single-end FASTQ file
    -S ${output_dir}/${sample_name}.sam \     # Output SAM file
    2> ${output_dir}/${sample_name}.err       # Alignment error log

done
